# Задачи проекта

## Текущий статус: ✅ ЗАВЕРШЕНО

## Последнее обновление: Рефакторинг системы отправки сообщений

**Описание:** Перенос логики отправки сообщений из сервера в композабл для упрощения архитектуры

**Решение:** Создание композабла `useContactForm.ts` с прямой отправкой в Telegram API

### Изменения:

**1. Архитектура отправки:**
- `useContactForm.ts` - новый композабл с логикой отправки
- Прямая отправка в Telegram Bot API
- Убран промежуточный сервер `server/index.js`

**2. Переменные окружения:**
- `VITE_TELEGRAM_BOT_TOKEN` - токен бота
- `VITE_TELEGRAM_CHAT_ID` - ID чата для отправки

**3. Обновление компонента:**
- `ContactForm.vue` использует новый композабл
- Упрощена логика обработки ошибок
- Улучшена типизация

### Результат ✅

- ✅ Упрощена архитектура (убран сервер)
- ✅ Улучшена производительность (прямая отправка)
- ✅ Упрощено развертывание
- ✅ Сохранена функциональность

---

## Проблема: Неправильный сброс игры

**Описание:** При сбросе игры (кнопка "Сбросить игру" или "Restart" в GameOver) возникали проблемы:
1. Бонусы не сбрасывались
2. Игра начиналась с 3 жизнями вместо максимальных 5
3. Дублирование логики сброса в двух местах

**Решение:** Централизация логики сброса в одном месте

### Исправления:

**1. Архитектура сброса:**
- `resetGame()` в `useApp.ts` - единственное место где происходит полный сброс
- `restartGame()` в `useModals.ts` - только очищает очередь модалок и вызывает `resetGame()`

**2. Логика полного сброса в `resetGame()`:**
- `bonuses.resetBonuses()` - сбрасывает разблокированные бонусы
- `startSession()` - сбрасывает достижения, опыт, уровень, жизни, посещенные пузыри, canvas
- `openWelcome()` - показывает приветственную модалку

**3. Исправление жизней:**
- При инициализации: `GAME_CONFIG.initialLives` (3 жизни)
- При сбросе: `GAME_CONFIG.maxLives` (5 жизней)
- Пользователь исправил это самостоятельно в `startSession()`

### Изменения:

**`src/composables/useApp.ts`:**
- Добавлен `bonuses.resetBonuses()` в `resetGame()`
- Добавлены комментарии для ясности архитектуры

**`src/composables/useModals.ts`:**
- Убрана дублирующая логика из `restartGame()`
- `restartGame()` теперь вызывает `resetGame()` из `useApp`
- Убран импорт `useBonuses` (больше не нужен)

### Финальная архитектура:

**Единая точка сброса:** `resetGame()` в `useApp.ts`
1. Сбрасывает бонусы
2. Вызывает `startSession()` который сбрасывает всё остальное
3. Показывает welcome модалку

**Два пути к сбросу:**
1. Кнопка "Сбросить игру" → `resetGame()` напрямую
2. GameOver "Restart" → `restartGame()` → очищает очередь → `resetGame()`

## Результат ✅

- ✅ Устранено дублирование логики сброса
- ✅ Бонусы корректно сбрасываются при любом типе сброса
- ✅ Игра начинается с правильным количеством жизней
- ✅ Единая архитектура для всех типов сброса
